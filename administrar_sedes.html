<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Administrar Sedes</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        body {
            background-color: #f8f9fa;
            font-family: "Segoe UI", sans-serif;
            margin: 0;
        }

        .contenedor-grande {
            max-width: 1000px;
            margin: auto;
        }

        /* CARD / CONTENIDO */
        .card {
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
            animation: fadeIn .35s ease;
        }

        .card-header {
            background-color: #1d3557;
            color: #ffffff;
            font-weight: 600;
        }

        .btn {
            border-radius: 20px;
            font-weight: 500;
            padding: 6px 14px !important;
            font-size: 13px !important;
            transition: all 0.15s ease-in-out;
        }

        .btn-primary {
            background-color: #1d3557;
            border-color: #1d3557;
        }

        .btn-primary:hover {
            background-color: #12263f;
            border-color: #12263f;
        }

        .btn-success,
        .btn-danger {
            border-radius: 20px;
        }

        table th, table td {
            text-align: center !important;
            vertical-align: middle !important;
            padding: 6px 10px !important;
            font-size: 13px;
            line-height: 1.2;
        }

        table thead th {
            background-color: #1d3557;
            color: #ffffff;
            font-weight: 600;
            font-size: 13px;
        }

        .table-striped > tbody > tr:nth-of-type(odd) > * {
            background-color: #f1f5fa;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to   { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

<div class="container contenedor-grande mt-4">
    <div class="card">
        <!-- HEADER -->
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
                <i class="bi bi-geo-alt-fill"></i> Administración de Sedes
            </h5>
            <a href="{{ url_for('dashboard') }}" class="btn btn-light btn-sm">
                <i class="bi bi-arrow-left-circle"></i> Volver
            </a>
        </div>

        <!-- BODY -->
        <div class="card-body">
            <div class="mb-3 d-flex gap-2">
                <a href="{{ url_for('agregar_sede') }}" class="btn btn-success">
                    <i class="bi bi-building-add"></i> Agregar Sede
                </a>
                <button id="btnEditar" class="btn btn-primary" disabled>
                    <i class="bi bi-pencil-square"></i> Editar
                </button>
                <button id="btnEliminar" class="btn btn-danger" disabled>
                    <i class="bi bi-trash"></i> Eliminar
                </button>
            </div>

            <div class="table-responsive">
                <table id="tablaSedes" class="table table-hover table-striped table-bordered align-middle text-center mb-0">
                    <thead>
                        <tr>
                            <th style="width: 50px;">
                                <input type="checkbox" id="selectAll">
                            </th>
                            <th>ID</th>
                            <th>Nombre de Sede</th>
                            <th>Dirección</th>
                            <th>Teléfono</th>
                            <th>Responsable Principal</th>
                            <th>Responsable Secundario</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for s in sedes %}
                        <tr data-id="{{ s.id_sede }}">
                            <td><input type="checkbox" class="check-sede"></td>
                            <td>{{ s.id_sede }}</td>
                            <td>{{ s.nombre_sede }}</td>
                            <td>{{ s.direccion or '-' }}</td>
                            <td>{{ s.telefono or '-' }}</td>
                            <td>{{ s.responsable_principal or 'Sin asignar' }}</td>
                            <td>{{ s.responsable_secundario or '-' }}</td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="7" class="text-muted text-center">
                                No hay sedes registradas.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    // Control de selección y botones
    const checkboxes = document.querySelectorAll(".check-sede");
    const selectAll  = document.getElementById("selectAll");
    const btnEditar  = document.getElementById("btnEditar");
    const btnEliminar= document.getElementById("btnEliminar");
    let idSeleccionado = null;

    checkboxes.forEach(chk => {
        chk.addEventListener("change", () => {
            // Solo una sede seleccionada a la vez
            checkboxes.forEach(c => { if (c !== chk) c.checked = false; });
            idSeleccionado      = chk.checked ? chk.closest("tr").getAttribute("data-id") : null;
            btnEditar.disabled  = !idSeleccionado;
            btnEliminar.disabled= !idSeleccionado;
        });
    });

    selectAll.addEventListener("change", () => {
        checkboxes.forEach(chk => chk.checked = selectAll.checked);
        if (selectAll.checked && checkboxes.length > 0) {
            idSeleccionado      = checkboxes[0].closest("tr").getAttribute("data-id");
            btnEditar.disabled  = false;
            btnEliminar.disabled= false;
        } else {
            idSeleccionado      = null;
            btnEditar.disabled  = true;
            btnEliminar.disabled= true;
        }
    });

    btnEditar.addEventListener("click", () => {
        if (!idSeleccionado) {
            alert("⚠️ Por favor, selecciona una sede primero.");
            return;
        }
        window.location.href = `/editar_sede/${idSeleccionado}`;
    });

    btnEliminar.addEventListener("click", () => {
        if (!idSeleccionado) {
            alert("⚠️ Selecciona una sede antes de eliminar.");
            return;
        }
        if (confirm("¿Seguro que deseas eliminar esta sede?")) {
            window.location.href = `/eliminar_sede/${idSeleccionado}`;
        }
    });
</script>

</body>
</html>
