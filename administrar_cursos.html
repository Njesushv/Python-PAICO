<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Administrar Cursos</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    body {
      background-color: #f8f9fa;
      font-family: "Segoe UI", sans-serif;
      margin: 0;
    }

    .contenedor-grande {
      max-width: 1500px;
      margin: auto;
    }

    /* CARD / CONTENIDO */
    .card {
      border-radius: 20px;
      overflow: hidden;
      animation: fadeIn .35s ease;
    }

    .card-header {
      background-color: #1d3557;
      color: #ffffff;
      font-weight: 600;
    }

    .btn {
      border-radius: 20px;
      font-weight: 500;
      padding: 6px 14px !important;
      font-size: 13px !important;
    }

    .btn-primary {
      background-color: #1d3557;
      border-color: #1d3557;
    }

    .btn-primary:hover {
      background-color: #12263f;
      border-color: #12263f;
    }

    .top-btn {
      padding: 8px 14px !important;
      font-size: 14px !important;
    }

    table th, table td {
      text-align: center !important;
      vertical-align: middle !important;
      padding: 6px 10px !important;
      font-size: 13px;
      line-height: 1.2;
    }

    table thead th {
      background-color: #1d3557;
      color: #fff;
      font-weight: 600;
      font-size: 13px;
    }

    .table-striped > tbody > tr:nth-of-type(odd) > * {
      background-color: #f1f5fa;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>

<body>

<div class="container contenedor-grande mt-4">
  <div class="card shadow">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0">
        <i class="bi bi-journal-text"></i> Administración de Cursos
      </h5>
      <a href="{{ url_for('dashboard') }}" class="btn btn-light top-btn">
        <i class="bi bi-arrow-left-circle"></i> Volver
      </a>
    </div>

    <div class="card-body">

      <div class="d-flex gap-2 mb-3">
        <!-- <a href="{{ url_for('agregar_curso') }}" class="btn btn-success">
          <i class="bi bi-plus-circle"></i> Agregar Curso
        </a> -->
        <button id="btnEditar" class="btn btn-primary" disabled>
          <i class="bi bi-pencil-square"></i> Editar Curso
        </button>
        <button id="btnEliminar" class="btn btn-danger" disabled>
          <i class="bi bi-trash"></i> Eliminar Curso
        </button>
      </div>

      <div class="table-responsive shadow-sm">
        <table id="tablaCursos" class="table table-hover table-striped align-middle text-center mb-0">
          <thead>
            <tr>
              <th style="width: 50px;">
                <input type="checkbox" id="selectAll" title="Seleccionar todos">
              </th>
              <th>ID</th>
              <th>Nombre</th>
              
              <th>Sede</th>
              <th>Aula</th>
              <th>Horario</th>
              <th>Duración del Curso</th>
            
            </tr>
          </thead>
          <tbody>
            {% for c in cursos %}
            <tr data-id="{{ c.id_curso }}">
              <td><input type="checkbox" class="check-curso"></td>
              <td>{{ c.id_curso }}</td>
              <td>{{ c.nombre }}</td>
 
              <td>{{ c.sede or 'Sin sede' }}</td>
              <td>{{ c.aula or '-' }}</td>
              <td>{{ c.horario or 'Sin horario' }}</td>
              <td>{{ c.fecha_inicio }} → {{ c.fecha_fin }}</td>

            </tr>
            {% else %}
            <tr>
              <td colspan="9" class="text-center text-muted py-4">
                <i class="bi bi-exclamation-circle"></i> No hay cursos registrados.
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

    </div>
  </div>
</div>

<!-- Toasts -->
<div id="toastExito" style="display:none;
     position: fixed;
     top: 20px;
     left: 50%;
     transform: translateX(-50%);
     background: #38a169;
     color: white;
     padding: 12px 24px;
     border-radius: 8px;
     font-weight: 600;
     box-shadow: 0 3px 10px rgba(0,0,0,0.2);
     z-index: 1050;">
    ✅ Curso eliminado correctamente
</div>

<div id="toastError" style="display:none;
     position: fixed;
     top: 20px;
     left: 50%;
     transform: translateX(-50%);
     background: #e53e3e;
     color: white;
     padding: 12px 24px;
     border-radius: 8px;
     font-weight: 600;
     box-shadow: 0 3px 10px rgba(0,0,0,0.2);
     z-index: 1050;">
    ⚠️ No se puede eliminar este curso porque tiene alumnos matriculados.
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const checkboxes   = document.querySelectorAll(".check-curso");
    const selectAll    = document.getElementById("selectAll");
    const btnEditar    = document.getElementById("btnEditar");
    const btnEliminar  = document.getElementById("btnEliminar");
    let idSeleccionado = null;

    // Selección individual (solo uno a la vez)
    checkboxes.forEach(chk => {
        chk.addEventListener("change", () => {
            // desmarcar todos los demás
            checkboxes.forEach(c => {
                if (c !== chk) c.checked = false;
            });

            const fila = chk.closest("tr");
            idSeleccionado = chk.checked ? fila.getAttribute("data-id") : null;

            btnEditar.disabled   = !idSeleccionado;
            btnEliminar.disabled = !idSeleccionado;

            // desmarcar "selectAll" si se desmarca el actual
            if (!chk.checked) {
                selectAll.checked = false;
            }
        });
    });

    // "Seleccionar todos" → realmente toma solo el PRIMERO
    selectAll.addEventListener("change", () => {
        checkboxes.forEach(chk => chk.checked = false);

        if (selectAll.checked && checkboxes.length > 0) {
            const first = checkboxes[0];
            first.checked = true;
            const fila = first.closest("tr");
            idSeleccionado = fila.getAttribute("data-id");
            btnEditar.disabled   = false;
            btnEliminar.disabled = false;
        } else {
            idSeleccionado = null;
            btnEditar.disabled   = true;
            btnEliminar.disabled = true;
        }
    });

    btnEditar.addEventListener("click", () => {
        if (!idSeleccionado) {
            alert("⚠️ Selecciona un curso primero.");
            return;
        }
        window.location.href = `/editar_curso/${idSeleccionado}`;
    });

    btnEliminar.addEventListener("click", () => {
        if (!idSeleccionado) {
            alert("⚠️ Selecciona un curso primero.");
            return;
        }
        if (confirm("¿Deseas eliminar este curso?")) {
            window.location.href = `/eliminar_curso/${idSeleccionado}`;
        }
    });
</script>


</body>
</html>
