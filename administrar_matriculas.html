<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Administrar Matr칤culas</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap.min.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
        }

        .contenedor-grande {
            max-width: 1700px;
            margin: auto;
        }

        /* CARD / CONTENIDO */
        .card {
            border-radius: 20px;
            overflow: hidden;
            animation: fadeIn .35s ease;
        }

        .card-header {
            background-color: #1d3557;
            color: #ffffff;
            font-weight: 600;
        }

        .btn {
            border-radius: 20px;
            font-weight: 500;
            padding: 4px 10px !important;
            font-size: 12px !important;
        }

        .top-btn {
            padding: 8px 14px !important;
            font-size: 14px !important;
        }

        .btn-primary {
            background-color: #1d3557;
            border-color: #1d3557;
        }

        .btn-primary:hover {
            background-color: #12263f;
            border-color: #12263f;
        }

        table th, table td {
            text-align: center !important;
            vertical-align: middle !important;
            padding: 6px 10px !important;
            font-size: 13px;
            line-height: 1.2;
        }

        table thead th {
            background-color: #1d3557;
            color: white;
            font-weight: 600;
            font-size: 13px;
        }

        tr:hover {
            background-color: #f1f3f5;
        }

        .badge {
            font-size: 0.9rem;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to   { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

<div class="container contenedor-grande mt-4">

    <div class="card shadow">
        <!-- HEADER -->
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
                <i class="bi bi-journal-bookmark-fill"></i> Administraci칩n de Matr칤culas
            </h5>
            <a href="{{ url_for('dashboard') }}" class="btn btn-light top-btn">
                <i class="bi bi-arrow-left-circle"></i> Volver
            </a>
        </div>











        <div class="card-body">




<!-- FILTROS -->
<form method="get" action="{{ url_for('administrar_matriculas') }}" class="row g-2 mb-3">
  <!-- Filtro por curso -->
  <div class="col-md-4">
    <select name="curso" class="form-select">
      <option value="">游닂 Filtrar por curso...</option>
      {% for c in cursos %}
        <option value="{{ c }}" {% if curso_filtro == c %}selected{% endif %}>
          {{ c }}
        </option>
      {% endfor %}
    </select>
  </div>

  <!-- Buscador de alumno -->
  <div class="col-md-4">
    <input
      type="text"
      name="buscar_alumno"
      class="form-control"
      placeholder="Alumno: nombre, DNI o c칩digo"
      value="{{ buscar_alumno or '' }}">
  </div>

  <!-- Bot칩n Buscar -->
  <div class="col-md-2">
    <button class="btn btn-primary w-100">
      <i class="bi bi-search"></i> Buscar
    </button>
  </div>

  <div class="col-md-2">
  <a href="{{ url_for('exportar_matriculas_pdf',
                      curso=curso_filtro,
                      buscar_alumno=buscar_alumno) }}"
     class="btn btn-danger w-100">
    <i class="bi bi-file-earmark-pdf"></i> Exportar PDF
  </a>
</div>


<div class="col-md-2">
  <a href="{{ url_for('exportar_matriculas_excel',
                      curso=curso_filtro,
                      buscar_alumno=buscar_alumno) }}"
     class="btn btn-success w-100">
    <i class="bi bi-file-earmark-spreadsheet"></i> Excel
  </a>
</div>


  <!-- Limpiar filtros -->
  <div class="col-md-2">
    <a href="{{ url_for('administrar_matriculas') }}" class="btn btn-secondary w-100">
      <i class="bi bi-x-circle"></i> Limpiar
    </a>
  </div>
</form>



















            <div class="table-responsive">
                <table class="table table-hover table-bordered align-middle text-center mb-0">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>C칩digo Alumno</th>
                            <th>Alumno</th>
                            <th>Curso</th>
                            <th>Aula</th>
                            <th>Inicio de Curso</th>
                            <th>Fin de Curso</th>    
                            <th>Instituci칩n</th>
                            <th>Sede</th>
                            <th>Fecha Matr칤cula</th>                           
                            <th>Monto Matr칤cula (S/)</th>
                            <th>Metodo de Pago</th>
                            <th>Saldo de Matricula (S/)</th>
                            <th>Mensualidad (S/)</th>
                            <th>Deuda (S/)</th>
                            <th>Fecha Vencimiento de Mensualidad</th>
                            <th>Observaci칩n</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for m in matriculas %}
                        <tr>
                            <td>{{ m.id_matricula }}</td>
                            <td>{{ m.codigo_alumno }}</td>
                            <td>{{ m.nombre_alumno }}</td>
                            <td>{{ m.nombre_curso }}</td>
                            <td>{{ m.aula or '' }}</td>
                            <td>{{ m.fecha_inicio_curso }}</td>
                            <td>{{ m.fecha_fin_curso }}</td>
                            <td>{{ m.institucion_alumno }}</td>
                            <td>{{ m.nombre_sede }}</td>
                            <td>{{ m.fecha_matricula }}</td>
                            <td>{{ "%.2f"|format(m.monto | float) }}</td>
                            <td>{{ m.metodo_pago or '' }}</td>
                            <td>{{ "%.2f"|format(m.saldo_matricula | float) }}</td>
                            <td>{{ "%.2f"|format(m.mensualidad | float) }}</td>
                            <td>{{ "%.2f"|format(m.deuda or 0) }}</td>
                            <td>{{ m.fecha_vencimiento or '' }}</td>
                            <td>{{ m.observacion or '' }}</td>

                            <td>
                                {% if m.estado == 'Matriculado (Pago inicial)' %}
                                    <span class="badge bg-success text-wrap">
                                        Matriculado<br>(Pago inicial)
                                    </span>
                                {% elif m.estado == 'Desertor' %}
                                    <span class="badge bg-warning text-dark">Desertor</span>
                                {% elif m.estado == 'Inactivo' %}
                                    <span class="badge bg-secondary">Inactivo</span>
                                {% else %}
                                    <span class="badge bg-dark">{{ m.estado }}</span>
                                {% endif %}
                            </td>

                            <td>
                                <a href="{{ url_for('editar_matricula', id_matricula=m.id_matricula) }}"
                                   class="btn btn-sm btn-primary">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <a href="{{ url_for('eliminar_matricula', id_matricula=m.id_matricula) }}"
                                   class="btn btn-sm btn-danger"
                                   onclick="return confirm('쯉eguro que deseas eliminar esta matr칤cula?')">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="11" class="text-muted text-center">
                                No hay matr칤culas registradas.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

        </div>
    </div>

</div>

</body>
</html>
