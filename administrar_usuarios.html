<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Administrar Usuarios</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap.min.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
        }

        .contenedor-grande {
            max-width: 1200px;
            margin: auto;
        }

        /* CARD / CONTENIDO (mismo estilo que matrículas) */
        .card {
            border-radius: 20px;
            overflow: hidden;
            animation: fadeIn .35s ease;
        }

        .card-header {
            background-color: #1d3557;
            color: #ffffff;
            font-weight: 600;
        }

        .btn {
            border-radius: 20px;
            font-weight: 500;
            padding: 4px 10px !important;
            font-size: 12px !important;
        }

        .top-btn {
            padding: 8px 14px !important;
            font-size: 14px !important;
        }

        .btn-primary {
            background-color: #1d3557;
            border-color: #1d3557;
        }

        .btn-primary:hover {
            background-color: #12263f;
            border-color: #12263f;
        }

        table th, table td {
            text-align: center !important;
            vertical-align: middle !important;
            padding: 6px 10px !important;
            font-size: 13px;
            line-height: 1.2;
        }

        table thead th {
            background-color: #1d3557;
            color: white;
            font-weight: 600;
            font-size: 13px;
        }

        tr:hover {
            background-color: #f1f3f5;
        }

        .badge {
            font-size: 0.8rem;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to   { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

<div class="container contenedor-grande mt-4">
    <div class="card shadow">
        <!-- HEADER -->
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
                <i class="bi bi-person-gear"></i> Administración de Usuarios
            </h5>
            <a href="{{ url_for('dashboard') }}" class="btn btn-light top-btn">
                <i class="bi bi-arrow-left-circle"></i> Volver
            </a>
        </div>

        <!-- BODY -->
        <div class="card-body">

            <!-- Botones superiores -->
            <div class="mb-3 d-flex flex-wrap gap-2">
                <a href="{{ url_for('agregar_usuario') }}" class="btn btn-success">
                    <i class="bi bi-person-plus"></i> Agregar Usuario
                </a>

                <button id="btnEditar" class="btn btn-primary" disabled>
                    <i class="bi bi-pencil-square"></i> Editar
                </button>

                <button id="btnEliminar" class="btn btn-danger" disabled>
                    <i class="bi bi-trash"></i> Eliminar
                </button>
            </div>

            <!-- TABLA -->
            <div class="table-responsive">
                <table id="tablaUsuarios" class="table table-hover table-bordered align-middle text-center mb-0">
                    <thead>
                        <tr>
                            <th>
                                <input type="checkbox" id="selectAll">
                            </th>
                            <th>ID</th>
                            <th>Nombre de Usuario</th>
                            <th>Rol</th>
                            <th>Sede(s)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for u in usuarios %}
                        <tr data-id="{{ u.id_usuario }}">
                            <td>
                                <input type="checkbox" class="check-usuario">
                            </td>
                            <td>{{ u.id_usuario }}</td>
                            <td>{{ u.nombre_usuario }}</td>
                            <td>{{ u.rol or '-' }}</td>
                            <td>
                                {% if u.sedes %}
                                    {% for sede in (u.sedes).split(' / ') %}
                                        <span class="badge bg-success text-wrap">
                                            {{ sede }}
                                        </span>
                                    {% endfor %}
                                {% else %}
                                    <span class="badge bg-secondary">Sin asignar</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="5" class="text-muted text-center">
                                No hay usuarios registrados.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

        </div> <!-- card-body -->
    </div> <!-- card -->
</div> <!-- container -->

<script>
    const checkboxes = document.querySelectorAll(".check-usuario");
    const selectAll  = document.getElementById("selectAll");
    const btnEditar  = document.getElementById("btnEditar");
    const btnEliminar = document.getElementById("btnEliminar");
    let idSeleccionado = null;

    // Selección individual (solo uno a la vez)
    checkboxes.forEach(chk => {
        chk.addEventListener("change", () => {
            checkboxes.forEach(c => {
                if (c !== chk) c.checked = false;
            });
            const fila = chk.closest("tr");
            idSeleccionado = chk.checked ? fila.getAttribute("data-id") : null;
            btnEditar.disabled = !idSeleccionado;
            btnEliminar.disabled = !idSeleccionado;
            // desmarcar "selectAll"
            if (!chk.checked) {
                selectAll.checked = false;
            }
        });
    });

    // Seleccionar todos (realmente agarra el primero como seleccionado)
    selectAll.addEventListener("change", () => {
        checkboxes.forEach(chk => chk.checked = selectAll.checked);
        if (selectAll.checked && checkboxes.length > 0) {
            idSeleccionado = checkboxes[0].closest("tr").getAttribute("data-id");
            btnEditar.disabled = false;
            btnEliminar.disabled = false;
        } else {
            idSeleccionado = null;
            btnEditar.disabled = true;
            btnEliminar.disabled = true;
        }
    });

    btnEditar.addEventListener("click", () => {
        if (!idSeleccionado) {
            alert("⚠️ Selecciona un usuario primero.");
            return;
        }
        window.location.href = `/editar_usuario/${idSeleccionado}`;
    });

    btnEliminar.addEventListener("click", () => {
        if (!idSeleccionado) {
            alert("⚠️ Selecciona un usuario primero.");
            return;
        }
        if (confirm("¿Deseas eliminar este usuario?")) {
            window.location.href = `/eliminar_usuario/${idSeleccionado}`;
        }
    });
</script>

</body>
</html>
